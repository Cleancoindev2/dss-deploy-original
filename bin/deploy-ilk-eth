#!/usr/bin/env bash

# shellcheck source=bin/lib/common.sh
. "${LIB_DIR:-$(cd "${0%/*}/lib"&&pwd)}/common.sh"

export ETH_FROM=${ETH_FROM:-$(seth rpc eth_coinbase)}

dappBuild

ETH_NONCE=${ETH_NONCE:-$(seth nonce "$ETH_FROM")}

test -z "$ETH" && ETH=$(ETH_NONCE=$ETH_NONCE dapp create WETH9_) && ETH_NONCE=$((ETH_NONCE + 1))

test -z "$PIP_ETH" && PIP_ETH=$(ETH_NONCE=$ETH_NONCE dapp create DSValue) && ETH_NONCE=$((ETH_NONCE + 1))

export ETH_NONCE
export ETH
export PIP_ETH

# shellcheck source=/dev/null
source "$BIN_DIR/deploy-ilk" "ETH" "${1:-"A"}" "GemJoin"

#! /usr/bin/env bash

# shellcheck source=bin/lib/common.sh
. "${LIB_DIR:-$(cd "${0%/*}/lib"&&pwd)}/common.sh"

# -----------------------------------------------------------------------------------------

test -z "$SKIP_BUILD" && {
  message CHECKING OUT DEPENDENCIES
  dapp update
}

# -----------------------------------------------------------------------------------------

ETH_NONCE=${ETH_NONCE:-$(seth nonce "$ETH_FROM")}
export ETH_NONCE

# -----------------------------------------------------------------------------------------

message DEPLOYING FABS

# shellcheck source=bin/deploy-fab
source "$BIN_DIR/deploy-fab"
# shellcheck source=/dev/null
source "$ADDRESS_DIR/load-fab-$(seth chain)"

# -----------------------------------------------------------------------------------------

message DEPLOYING CORE

# shellcheck source=bin/deploy-core
source "$BIN_DIR/deploy-core"
# shellcheck source=/dev/null
source "$ADDRESS_DIR/load-mcd-$(seth chain)"

# -----------------------------------------------------------------------------------------

message DEPLOYING ETH

# shellcheck source=bin/deploy-ilk-eth
source "$BIN_DIR/deploy-ilk-eth"
# shellcheck source=/dev/null
source "$ADDRESS_DIR/load-ilk-eth-a-$(seth chain)"

# -----------------------------------------------------------------------------------------

message DEPLOYING COL1

# shellcheck source=bin/deploy-ilk-col1
source "$BIN_DIR/deploy-ilk-col1"
# shellcheck source=/dev/null
source "$ADDRESS_DIR/load-ilk-col1-a-$(seth chain)"

# -----------------------------------------------------------------------------------------

message DEPLOYING COL2

# shellcheck source=bin/deploy-ilk-col2
source "$BIN_DIR/deploy-ilk-col2"
# shellcheck source=/dev/null
source "$ADDRESS_DIR/load-ilk-col2-a-$(seth chain)"

# -----------------------------------------------------------------------------------------

message DEPLOYING COL3

# shellcheck source=bin/deploy-ilk-col3
source "$BIN_DIR/deploy-ilk-col3"
# shellcheck source=/dev/null
source "$ADDRESS_DIR/load-ilk-col3-a-$(seth chain)"

# -----------------------------------------------------------------------------------------

message DEPLOYING COL4

# shellcheck source=bin/deploy-ilk-col4
source "$BIN_DIR/deploy-ilk-col4"
# shellcheck source=/dev/null
source "$ADDRESS_DIR/load-ilk-col4-a-$(seth chain)"

# -----------------------------------------------------------------------------------------

message DEPLOYING COL5

# shellcheck source=bin/deploy-ilk-col5
source "$BIN_DIR/deploy-ilk-col5"
# shellcheck source=/dev/null
source "$ADDRESS_DIR/load-ilk-col5-a-$(seth chain)"

# -----------------------------------------------------------------------------------------

export ETH_NONCE

# -----------------------------------------------------------------------------------------

#! /usr/bin/env bash

[[ -z $TMP_FILE ]] && {
  nonce=$(seth nonce "$ETH_FROM")
  TMP_FILE=$(mktemp /tmp/nonce.XXXXXX)
  echo "$nonce" > "$TMP_FILE"
  export TMP_FILE
}

# shellcheck source=bin/lib/common.sh
. "${LIB_DIR:-$(cd "${0%/*}/lib"&&pwd)}/common.sh"

# -----------------------------------------------------------------------------------------

test -z "$SKIP_BUILD" && {
  message CHECKING OUT DEPENDENCIES
  dapp update
}

# -----------------------------------------------------------------------------------------

message DEPLOYING FABS

"$BIN_DIR/deploy-fab"
# shellcheck source=/dev/null
source "$ADDRESS_DIR/load-fab-$(seth chain)"

# -----------------------------------------------------------------------------------------

message DEPLOYING CORE

"$BIN_DIR/deploy-core"
# shellcheck source=/dev/null
source "$ADDRESS_DIR/load-mcd-$(seth chain)"

# -----------------------------------------------------------------------------------------

message DEPLOYING ETH

"$BIN_DIR/deploy-ilk-eth"
# shellcheck source=/dev/null
source "$ADDRESS_DIR/load-ilk-eth-a-$(seth chain)"

# -----------------------------------------------------------------------------------------

message DEPLOYING COL1

"$BIN_DIR/deploy-ilk-col1"
# shellcheck source=/dev/null
source "$ADDRESS_DIR/load-ilk-col1-a-$(seth chain)"

# -----------------------------------------------------------------------------------------

message DEPLOYING COL2

"$BIN_DIR/deploy-ilk-col2"
# shellcheck source=/dev/null
source "$ADDRESS_DIR/load-ilk-col2-a-$(seth chain)"

# -----------------------------------------------------------------------------------------

message DEPLOYING COL3

"$BIN_DIR/deploy-ilk-col3"
# shellcheck source=/dev/null
source "$ADDRESS_DIR/load-ilk-col3-a-$(seth chain)"

# -----------------------------------------------------------------------------------------

message DEPLOYING COL4

"$BIN_DIR/deploy-ilk-col4"
# shellcheck source=/dev/null
source "$ADDRESS_DIR/load-ilk-col4-a-$(seth chain)"

# -----------------------------------------------------------------------------------------

message DEPLOYING COL5

"$BIN_DIR/deploy-ilk-col5"
# shellcheck source=/dev/null
source "$ADDRESS_DIR/load-ilk-col5-a-$(seth chain)"

# -----------------------------------------------------------------------------------------
